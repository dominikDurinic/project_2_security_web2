import { useState } from "react";
import { Footer } from "../components/Footer";
import { Header } from "../components/Header";
import "../styles/Vulnerability.css";
import data from "../../data/task.json";

interface TaskData {
  id: string;
  title: string;
  srcImage: string;
  simulation: string;
  story: string;
  task: string[];
}

export function Vulnerability(props: { id: number }) {
  const newData: TaskData[] = JSON.parse(JSON.stringify(data));
  const [vule, setVule] = useState(false);
  const [msg, setMsg] = useState<string>("");
  const [msgList, setMsgList] = useState<string[]>([]);

  function sendMsg(value: string) {
    setMsgList(msgList.concat(value));
  }

  return (
    <>
      <Header selected={0} />
      <main>
        <h2>{newData[props.id - 1].title}</h2>
        <div className="task-div">
          <h3>Simulacija:</h3>
          <p>{newData[props.id - 1].simulation}</p>
          <h3>Priča:</h3>
          <p>{newData[props.id - 1].story}</p>
          <h3>Zadatak:</h3>
          <div>
            {newData[props.id - 1].task.map((item, index) => (
              <>
                {index > 0 ? (
                  <p>
                    {index}. {item}
                  </p>
                ) : (
                  <p>{item}</p>
                )}
              </>
            ))}
          </div>
        </div>
        <div className={`task-container ${vule ? "red-border" : ""}`}>
          <div className="vule-switch-container">
            <p>Ranjivost aplikacije: {vule ? "Uključena" : "Isključena"}</p>
            <div className="switch-div">
              <p>Ranjivost</p>
              <div className="switch">
                <div
                  onClick={() => setVule(true)}
                  className={`switch-btn ${vule ? "sw-blu" : "sw-gray"}`}
                >
                  I
                </div>
                <div
                  onClick={() => setVule(false)}
                  className={`switch-btn ${vule ? "sw-gray" : "sw-blu"}`}
                >
                  O
                </div>
              </div>
            </div>
          </div>

          <div className="input-div">
            <input
              placeholder="Enter your message..."
              onChange={(e) => setMsg(e.target.value)}
              value={msg}
            />
            <button
              className="btn-chat"
              onClick={() => {
                sendMsg(msg);
                setMsg("");
              }}
            >
              Pošalji
            </button>
          </div>

          <div className="chat-box">
            <div className="coach-msg-div">
              <div className="msg-box msg-box-coach">
                <p>Pozdrav, admin! Kako se osjećaš danas?</p>
              </div>
            </div>
            {msgList.map((msg, index) => (
              <div className="me-msg-div" key={index}>
                <div className="msg-box msg-box-me">
                  <p>{msg}</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </main>
      <Footer />
    </>
  );
}
